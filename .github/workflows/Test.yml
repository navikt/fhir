name: Test

on:
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest
    outputs:
      apps: ${{ steps.diff.outputs.apps }}
    steps:
      - id: diff
        run: echo "::set-output name=apps::[hops-api, hops-eventstore]"
  
  test:
    needs: setup
    strategy:
      fail-fast: false
      matrix:
        app: ${{ needs.setup.outputs.apps }}
    env:
      IMAGE: ghcr.io/navikt/${{ matrix.app }}:e564a55271271bf3aecadf263ba61d6a00014f7e
    runs-on: ubuntu-latest
    steps:
      - name: ‚ùî Check if image exists
        id: check_image
        run: |
          if [[ $(docker manifest inspect ${{ env.IMAGE }}) ]]; then
            echo "::set-output name=exists::true"
          else
            echo "::set-output name=exists::false"
          fi

      - name: print
        if: ${{ steps.check_image.outputs.exists }}
        run: |
          echo "Image exists!"

      - name: print
        if: ${{ steps.check_image.outputs.exists }}
        run: |
          echo "Image does not exists!"