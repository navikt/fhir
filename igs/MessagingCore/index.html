<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>NAV.NO.MESSAGING.CORE.R4\Home - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="ext/override.css" rel="stylesheet" />
<script src="ext/override.js" />


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"1"}
    h3,h4,h5,h6{--heading-prefix:"1"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="nav-nav">
  <a
    id="nav-logo"
    href="https://www.nav.no/no/nav-og-samfunn/kontakt-nav/presse/snarveier/bilder-og-logoer/arbeids-og-velferdsdirektoratet"
  >
    <img height="50" alt="NAV Logo" src="ext/logo.svg" />
  </a>
  <div class="nav-source">
    <a
      href="https://github.com/navikt/fhir"
      title="Go to repository"
      target="_blank"
    >
      <div class="nav-source-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
      </div>
      <div>
        <div class="nav-source-repo-name">GitHub</div>
        <ul id="nav-source-repo-features">
        </ul>
      </div>
    </a>
  </div>
</div>


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold"></span><br/>0.1.0 - ci-build</p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li>
    <a href="CHANGELOG.html">History</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>Home</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">Publication Build: This will be filled in by the publication tooling</p><!--EndReleaseHeader-->
  <h2>Home</h2>
  









    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#actors" id="markdown-toc-actors">Actors</a></li>
  <li><a href="#messaging-vs-restful" id="markdown-toc-messaging-vs-restful">Messaging vs. RESTful</a></li>
  <li><a href="#workflow" id="markdown-toc-workflow">Workflow</a></li>
  <li><a href="#polling-vs-pushing" id="markdown-toc-polling-vs-pushing">Polling vs. Pushing</a></li>
  <li><a href="#addressing-her-id" id="markdown-toc-addressing-her-id">Addressing (HER-id)</a></li>
</ul>

</div>
<p>This <a href="https://www.hl7.org/fhir/implementationguide.html">FHIR Implementation Guide</a> (IG) describes a <strong>proposal</strong> to how the <a href="https://www.hl7.org/fhir/messaging.html">FHIR messaging pattern</a> can be used in communication between NAV and Electronic Health Record (EHR) systems.</p>

<p>There are currently no national IG on how FHIR messaging shall be used in Norway, but the need for such an IG <a href="https://github.com/HL7Norway/best-practice/blob/master/docs/messaging.md">has been recognized</a> by The Norwegian Directorate of eHealth, partially to replace the currently used ebXML-based <a href="https://www.ehelse.no/Standardisering/standarder/dialogmelding-v1.1">Dialogmelding</a>. This is why NAV is developing this IG, which hopefully can contribute in creating an official national IG accepted by the Norwegian health sector.</p>

<p>NAV is committed to adhere to whatever standards or best-practices the Norwegian health sector adopts, and have no interest in creating a separate custom integration pattern, it is therefore important to recognize this IG as a <em>proposal</em>, which is open to feedback and adjustments.</p>

<h3 id="actors">Actors</h3>
<p>The primary actors in context of this IG are:</p>
<ol>
  <li><strong>EHRs</strong>, “Elektronisk Pasient Journal (EPJ)”, are systems that contains and manages health information related to a patient and the services that operate on this data.</li>
  <li><strong>NAV</strong> is the Norwegian Labour and Welfare Administration and includes all the services managed by NAV.</li>
</ol>

<h3 id="messaging-vs-restful">Messaging vs. RESTful</h3>
<p>FHIR Messaging and FHIR RESTful API are two patterns defined in the <a href="https://www.hl7.org/fhir/exchange-module.html">FHIR specification</a>.</p>

<p>The RESTful API pattern is the most stable and widely used pattern for exchanging FHIR resources. This pattern is well suited for exchanging data between front-end apps and back-end services, e.g. SMART-on-FHIR apps.</p>

<p>The Messaging pattern can be more suitable for exchange between disparate organizations with low levels of process integration and/or trust. For instance, it might be preferred by an organization/system that has not necessarily adopted FHIR internally to receive a FHIR message containing a coherent snapshot of the complete context. The alternative would be to pull the required resources from multiple REST endpoints, where the lifecycle and versioning of these resources also must be considered.</p>

<p>Figure 1 visualizes exchange of FHIR messages between three different organizations, each having multiple internal systems that communicates using different patterns and protocols.</p>

<h4 id="figure-1">Figure 1</h4>
<p><a href="https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoiZmxvd2NoYXJ0ICBcbiAgICBzdWJncmFwaCBOQVZcbiAgICBkaXJlY3Rpb24gTFJcbiAgICB5MS0tPnxGSElSIFJFU1RmdWx8eTJcbiAgICB5MS0tPnxLYWZrYXx5M1xuICAgIGVuZFxuICAgIHN1YmdyYXBoIEVIUjJcbiAgICB6Mi0tPnoxXG4gICAgejEtLT58cHJvcHJpZXRhcnl8ejJcbiAgICB6My0tPnxvcGVuRUhSfHoyXG4gICAgZW5kXG4gICAgc3ViZ3JhcGggRUhSMVxuICAgIGRpcmVjdGlvbiBMUlxuICAgIHgxLS0-eDJcbiAgICB4Mi0tPnxGSElSIFJFU1RmdWx8eDNcbiAgICB4My0tPngyXG4gICAgeDQtLT58cHJvcHJpZXRhcnl8eDNcbiAgICBlbmRcbiAgICBFSFIxLS4gRkhJUiBNZXNzYWdpbmcgLi0-TkFWXG4gICAgTkFWLS4tPkVIUjFcbiAgICBOQVYtLiBGSElSIE1lc3NhZ2luZyAuLT5FSFIyXG4gICAgRUhSMi0uLT5OQVZcbiAgICBzdHlsZSBFSFIxIGZpbGw6IzU0OTlDNyxzdHJva2U6IzMzM1xuICAgIHN0eWxlIE5BViBmaWxsOiNFNzRDM0Msc3Ryb2tlOiMzMzMiLCJtZXJtYWlkIjoie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ"><img src="https://mermaid.ink/img/eyJjb2RlIjoiZmxvd2NoYXJ0ICBcbiAgICBzdWJncmFwaCBOQVZcbiAgICBkaXJlY3Rpb24gTFJcbiAgICB5MS0tPnxGSElSIFJFU1RmdWx8eTJcbiAgICB5MS0tPnxLYWZrYXx5M1xuICAgIGVuZFxuICAgIHN1YmdyYXBoIEVIUjJcbiAgICB6Mi0tPnoxXG4gICAgejEtLT58cHJvcHJpZXRhcnl8ejJcbiAgICB6My0tPnxvcGVuRUhSfHoyXG4gICAgZW5kXG4gICAgc3ViZ3JhcGggRUhSMVxuICAgIGRpcmVjdGlvbiBMUlxuICAgIHgxLS0-eDJcbiAgICB4Mi0tPnxGSElSIFJFU1RmdWx8eDNcbiAgICB4My0tPngyXG4gICAgeDQtLT58cHJvcHJpZXRhcnl8eDNcbiAgICBlbmRcbiAgICBFSFIxLS4gRkhJUiBNZXNzYWdpbmcgLi0-TkFWXG4gICAgTkFWLS4tPkVIUjFcbiAgICBOQVYtLiBGSElSIE1lc3NhZ2luZyAuLT5FSFIyXG4gICAgRUhSMi0uLT5OQVZcbiAgICBzdHlsZSBFSFIxIGZpbGw6IzU0OTlDNyxzdHJva2U6IzMzM1xuICAgIHN0eWxlIE5BViBmaWxsOiNFNzRDM0Msc3Ryb2tlOiMzMzMiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9" alt="" /></a></p>

<h3 id="workflow">Workflow</h3>
<p>The FHIR Messaging pattern does not describe <em>how</em> messages should be transferred. This can be done using Kafka, MQ, FTP, file-store, email, HTTP (including FHIR RESTful API) or any other current or future protocol. Messaging is also not limited to using a single protocol: the same message can be available on multiple channels or be passed through multiple protocols before arriving at the destination.</p>

<p>A simple and powerful way to exchange messages is to simply provide two endpoints: Publish and Retrieve. The <a href="https://www.hl7.org/fhir/messaging.html#process">specification</a> contains examples of this using the FHIR RESTful API; Publish can be implemented as either <code class="language-plaintext highlighter-rouge">POST: {base}/$process-message</code> or <code class="language-plaintext highlighter-rouge">POST: {base}/Bundle</code>, and retrieval can be implemented as <code class="language-plaintext highlighter-rouge">GET: {base}/Bundle</code>. There is a choice between using $process-message and Bundle for publish; NAV is leaning towards the former due to it already being used by <a href="http://build.fhir.org/ig/HL7/davinci-alerts/branches/master/guidance.html">Da-Vinci project</a> and <a href="https://simplifier.net/guide/DigitalMedicines/process-message">NHS Digital</a>.</p>

<p>HTTP and REST as a message\event exchange protocol might be perceived by some as “old fashion”, but it is a well established protocol that all developers should be familiar with and serves well as a common denominator. Integrators are still able to forward the messages to whatever internal event-streaming technology they prefer.</p>

<h4 id="figure-2">Figure 2</h4>
<p><a href="https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcmVjdCByZ2JhKDAsIDI1NSwgMCwgLjEpXG4gICAgbG9vcCBwZXJpb2RpYyBwb2xsaW5nXG4gICAgRUhSLT4-TkFWOiBHRVQgL0J1bmRsZT9tZXNzYWdlLmRlc3RpbmF0aW9uLXVyaT17aGVyLWlkfSZfb2Zmc2V0PXtvZmZzZXR9XG4gICAgTkFWLT4-RUhSOiBTZWFyY2hSZXN1bHRzW01lc3NhZ2VdXG4gICAgZW5kXG4gICAgZW5kXG5cbiAgICByZWN0IHJnYmEoMjU1LCAwLCAwLCAuMSlcbiAgICBFSFItPj5OQVY6IFBPU1QgLyRwcm9jZXNzLW1lc3NhZ2VcbiAgICBOQVYtPj5FSFI6IDIwMiBBY2NlcHRlZFxuICAgIGVuZCIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9"><img src="https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcmVjdCByZ2JhKDAsIDI1NSwgMCwgLjEpXG4gICAgbG9vcCBwZXJpb2RpYyBwb2xsaW5nXG4gICAgRUhSLT4-TkFWOiBHRVQgL0J1bmRsZT9tZXNzYWdlLmRlc3RpbmF0aW9uLXVyaT17aGVyLWlkfSZfb2Zmc2V0PXtvZmZzZXR9XG4gICAgTkFWLT4-RUhSOiBTZWFyY2hSZXN1bHRzW01lc3NhZ2VdXG4gICAgZW5kXG4gICAgZW5kXG5cbiAgICByZWN0IHJnYmEoMjU1LCAwLCAwLCAuMSlcbiAgICBFSFItPj5OQVY6IFBPU1QgLyRwcm9jZXNzLW1lc3NhZ2VcbiAgICBOQVYtPj5FSFI6IDIwMiBBY2NlcHRlZFxuICAgIGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0" alt="" /></a></p>

<h3 id="polling-vs-pushing">Polling vs. Pushing</h3>
<p>Polling is often simpler to implement and test than a Push-based exchange, especially when reliability, throttling and retries are taken into consideration.</p>

<p>NAV foresee a FHIR RESTful compliant service with the ability to query messages using <a href="https://www.hl7.org/fhir/bundle.html#search">Bundle search parameters</a>. These messages are represented as a long list of immutable messages ordered from first to last that can be paginated using an offset parameter. Clients can then consume messages at their own pace and even “replay” old messages, new messages are awaited by continuously poll with an offset equal the last entry, this pattern is similar to interacting with a Kafka partition.</p>

<h3 id="addressing-her-id">Addressing (HER-id)</h3>
<p>FHIR Messaging requires a way to identify a message’s <em>source</em> and <em>destination</em> endpoints. These endpoints can be either a protocol-specific endpoint, such as a HTTP URL or email-address, or an identifier used to identify a logical entity without specifying <em>how</em> the message should be delivered.</p>

<p>In order to be technology agnostic, the message-model must be separated from the transfer-protocol. This allows a message to be routed unmodified through multiple intermediates and protocols before arriving at the destination.</p>

<p>In Norway we already have an established standard to identify communicating entities within the health sector called <a href="https://www.ehelse.no/standardisering/om-standardisering-i-e-helse/tjenestebasert-adressering#Om%20tjenestebasert%20adressering%20og%20tjenestetyper">Tjenestebasert adressering</a>. This standard does not force any particular transfer-protocol and can therefore be used to identify <em>source</em> and <em>destination</em> as logical entities in a FHIR message. Such an identifier is called <em>HER-id</em> and shall be populated in the required message elements: <code class="language-plaintext highlighter-rouge">source.endpoint</code> and <code class="language-plaintext highlighter-rouge">destination.endpoint</code>. Because these elements requires an URI we use HER-id’s <a href="https://www.ehelse.no/teknisk-dokumentasjon/oid-identifikatorserier-i-helse-og-omsorgstjenesten">reserved OID namespace</a> to create a fully-qualified URI, example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"destination"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.578.1.12.4.1.2.102287"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &#169; 2021+ <a style="color:var(--footer-hyperlink-text-color)" href="https://github.com/navikt/fhir">Norwegian Labour and Welfare Administration (NAV)</a>.  Package nav.no.messaging.core.r4#0.1.0 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Fri, Oct 8, 2021 13:22+0000">2021-10-08</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)"></span>
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

